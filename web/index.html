<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recetas ‚Äì Demo Front</title>
  <style>
    :root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
    body { margin: 0; background: #0b0f14; color: #e6edf3; }
    header { padding: 16px 20px; background: #121821; border-bottom: 1px solid #263043; }
    h1 { margin: 0; font-size: 20px; }
    main { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; padding: 20px; }
    .card { background: #11161f; border: 1px solid #223047; border-radius: 14px; padding: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.25); }
    .card h2 { margin: 0 0 8px; font-size: 18px; }
    label { display:block; margin: 8px 0 4px; font-size: 13px; color: #9fb3c8; }
    input, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a3b55; background: #0d1320; color: #e6edf3; }
    textarea { min-height: 80px; resize: vertical; }
    button { margin-top: 10px; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a3b55; background: #1b2738; color: #e6edf3; cursor: pointer; }
    button:hover { filter: brightness(1.1); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .muted { color: #9fb3c8; font-size: 12px; }
    pre { background: #0c111b; border: 1px solid #223047; padding: 12px; border-radius: 10px; overflow: auto; }
    .ok { color: #6be675; }
    .err { color: #ff8f6b; }
    .topbar { display:flex; gap:12px; align-items:center; }
    .topbar input { width: 280px; }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <h1>üç≥ Recetas ‚Äì Front de prueba</h1>
      <span style="flex:1"></span>
      <label class="muted" for="baseUrl">Base URL</label>
      <input id="baseUrl" value="http://localhost:8080" />
      <button id="pingBtn">Probar /health</button>
      <span id="pingStatus" class="muted"></span>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>Productos</h2>
      <div class="row">
        <div>
          <label>Nombre</label>
          <input id="pName" placeholder="Harina" />
        </div>
        <div>
          <label>Unidad</label>
          <input id="pUnit" placeholder="g, ml, u" />
        </div>
      </div>
      <button id="addProduct">Crear producto</button>
      <button id="listProducts">Listar productos</button>
      <pre id="productsOut" class="muted">(sin datos)</pre>
    </section>

    <section class="card">
      <h2>Recetas</h2>
      <label>Nombre</label>
      <input id="rName" placeholder="Pan casero" />
      <label>Pasos</label>
      <textarea id="rSteps" placeholder="1) Mezclar\n2) Amasar\n3) Hornear"></textarea>
      <button id="addRecipe">Crear receta</button>
      <button id="listRecipes">Listar recetas</button>
      <pre id="recipesOut" class="muted">(sin datos)</pre>

      <hr style="border:0;border-top:1px solid #223047;margin:14px 0;" />
      <h3>Agregar ingrediente a receta</h3>
      <div class="row">
        <div>
          <label>ID Receta</label>
          <input id="riRecipeId" type="number" placeholder="1" />
        </div>
        <div>
          <label>ID Producto</label>
          <input id="riProductId" type="number" placeholder="1" />
        </div>
      </div>
      <label>Cantidad</label>
      <input id="riQty" type="number" step="0.01" placeholder="500" />
      <button id="addRecipeItem">Agregar a receta</button>
      <pre id="recipeItemOut" class="muted">(sin datos)</pre>
    </section>

    <section class="card">
      <h2>Listas de compras</h2>
      <label>Nombre de la lista</label>
      <input id="slName" placeholder="Compras del finde" />
      <label>IDs de recetas (separados por coma)</label>
      <input id="slRecipeIds" placeholder="1,2" />
      <button id="createShoppingList">Crear lista desde recetas</button>
      <pre id="shoppingCreateOut" class="muted">(sin datos)</pre>

      <hr style="border:0;border-top:1px solid #223047;margin:14px 0;" />
      <h3>Ver lista</h3>
      <label>ID Lista</label>
      <input id="slId" type="number" placeholder="1" />
      <button id="getShoppingList">Obtener lista</button>
      <pre id="shoppingGetOut" class="muted">(sin datos)</pre>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const j = (obj) => JSON.stringify(obj, null, 2);
    const base = () => $("baseUrl").value.replace(/\/$/, "");

    async function fx(path, opts = {}) {
      const res = await fetch(base() + path, {
        headers: { "content-type": "application/json" },
        ...opts,
      });
      const text = await res.text();
      try { return { ok: res.ok, status: res.status, data: JSON.parse(text) }; }
      catch { return { ok: res.ok, status: res.status, data: text }; }
    }

    // Ping
    $("pingBtn").onclick = async () => {
      $("pingStatus").textContent = "probando‚Ä¶";
      const r = await fx("/health");
      $("pingStatus").innerHTML = r.ok
        ? `‚úîÔ∏è <span class="ok">${r.status}</span> ${j(r.data)}`
        : `‚ùå <span class="err">${r.status}</span> ${j(r.data)}`;
    };

    // Productos
    $("addProduct").onclick = async () => {
      const body = { name: $("pName").value, unit: $("pUnit").value };
      const r = await fx("/products", { method: "POST", body: JSON.stringify(body) });
      $("productsOut").textContent = j(r);
    };
    $("listProducts").onclick = async () => {
      const r = await fx("/products");
      $("productsOut").textContent = j(r);
    };

    // Recetas
    $("addRecipe").onclick = async () => {
      const body = { name: $("rName").value, steps: $("rSteps").value };
      const r = await fx("/recipes", { method: "POST", body: JSON.stringify(body) });
      $("recipesOut").textContent = j(r);
    };
    $("listRecipes").onclick = async () => {
      const r = await fx("/recipes");
      $("recipesOut").textContent = j(r);
    };

    // Items de receta
    $("addRecipeItem").onclick = async () => {
      const rid = Number($("riRecipeId").value);
      const body = { product_id: Number($("riProductId").value), qty: Number($("riQty").value) };
      const r = await fx(`/recipes/${rid}/items`, { method: "POST", body: JSON.stringify(body) });
      $("recipeItemOut").textContent = j(r);
    };

    // Listas de compras
    $("createShoppingList").onclick = async () => {
      const ids = $("slRecipeIds").value.split(",").map(s => Number(s.trim())).filter(Boolean);
      const body = { name: $("slName").value, recipe_ids: ids };
      const r = await fx("/shopping-lists", { method: "POST", body: JSON.stringify(body) });
      $("shoppingCreateOut").textContent = j(r);
    };

    $("getShoppingList").onclick = async () => {
      const id = Number($("slId").value);
      const r = await fx(`/shopping-lists/${id}`);
      $("shoppingGetOut").textContent = j(r);
    };
  </script>
</body>
</html>
